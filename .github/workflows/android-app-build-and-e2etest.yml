name: android-app-build-and-e2etest

on:
  push:
    branches: [main]
  workflow_dispatch:

jobs:
  build-and-e2etest:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2

      # - name: Install node package from dependency
      #   run: |
      #     cd __e2e__
      #     npm ci

      # - name: Check environment by appium-doctor
      #   run: |
      #     cd __e2e__
      #     npm run doctor

      # - name: Build apk
      #   run: |
      #     chmod +x gradlew
      #     ./gradlew assembleDebug

      - name: Create AVD
        run: |
          cd /usr/local/lib/android/sdk/cmdline-tools/latest
          ls -al
          SYSTEM_IMAGES="system-images;android-28;default;x86"
          sudo $ANDROID_HOME/cmdline-tools/latest/bin/sdkmanager "$SYSTEM_IMAGES"
          echo "no" | avdmanager --verbose create avd -n test -k "$SYSTEM_IMAGES"

      - name: Start android emulator
        run: emulator -avd test -delay-adb -verbose -no-window -gpu swiftshader_indirect -no-snapshot -noaudio -no-boot-anim

      - name: Disable emulator animation
        run: |
          adb shell settings put global window_animation_scale 0.0
          adb shell settings put global transition_animation_scale 0.0
          adb shell settings put global animator_duration_scale 0.0
